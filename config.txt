# ==================================================
# 项目根配置（start_all.bat 所在目录）
# ==================================================

# 是否启用 RAG（会引入 torch，启动慢）
# ==================================================
RAG_ENABLED=1


# ==================================================
# GPT-SoVITS（TTS 服务）
# ==================================================

GPTSOVITS_DIR=GPT-SoVITS
GPTSOVITS_API=GPT-SoVITS\api_v2.py
GPTSOVITS_HOST=0.0.0.0
GPTSOVITS_PORT=9880
GPTSOVITS_REDIRECT_LOG=0
GPTSOVITS_ARGS=

# smart_anchor.py 调用用
GPTSOVITS_URL=http://127.0.0.1:9880
TTS_REF_AUDIO_PATH=C:\Users\SHAWN.FU\Desktop\AI-Anchor\GPT-SoVITS\ref\default.wav
TTS_PROMPT_TEXT=为什么抛弃更高效更坚固的形态？

# TTS 参数（smart_anchor.py 读取，env > config > 默认）
TTS_TEXT_LANG=zh
TTS_PROMPT_LANG=zh
TTS_MEDIA_TYPE=wav
# 是否开启一次性 TTS 的 streaming_mode（tts_to_file payload 用）
TTS_STREAMING_MODE=0
# 流式返回 iter_content chunk 大小（bytes）
TTS_STREAM_CHUNK_SIZE=65536


# ==================================================
# LMDeploy（LLM 服务）
# ==================================================

LMDEPLOY_SUBCMD=serve api_server
LMDEPLOY_MODEL_PATH=model\internlm2_5-7b-chat-int4
LMDEPLOY_BACKEND=turbomind
LMDEPLOY_MODEL_FORMAT=awq
LMDEPLOY_MODEL_NAME=internlm2_5-7b-chat-int4

LMDEPLOY_SERVER_NAME=0.0.0.0
LMDEPLOY_SERVER_PORT=23333
LMDEPLOY_TP=1
LMDEPLOY_SESSION_LEN=2048
LMDEPLOY_CACHE_MAX_ENTRY_COUNT=0.35

# API Server & health check 使用
LMDEPLOY_HOST=127.0.0.1
LMDEPLOY_PORT=23333


# ==================================================
# API Server（api_server_backup.py 实际读取）
# ==================================================

API_ENTRY=api_server.py
API_HOST=0.0.0.0
API_PORT=8000
API_RELOAD=false
API_LOG_LEVEL=info

# 可选：浏览器自动打开用（不写则 http://127.0.0.1:{API_PORT}）
# API_PUBLIC_BASE_URL=http://127.0.0.1:8000

DISABLE_AUTO_OPEN=0
AUTO_OPEN_DELAY_MS=600

# CORS
CORS_ALLOW_ORIGINS=*
CORS_ALLOW_CREDENTIALS=true
CORS_ALLOW_METHODS=*
CORS_ALLOW_HEADERS=*

# 静态资源
STATIC_WEB_PATH=web
STATIC_LIVE2D_PATH=Live2D

# 数据目录
DATA_TTS_DIR=data/tts
DATA_LIVE_SESSIONS_DIR=data/live_sessions

# 默认会话
DEFAULT_ROOM=default_room
DEFAULT_SENDER_NAME=用户

# 调试
DEBUG_LLM_STREAM=0
DEBUG_LLM_MAX_CHARS=200

# health check
HEALTH_CHECK_TIMEOUT_SECONDS=5


# ==================================================
# 主播人格 / 知识库（smart_anchor）
# ==================================================

ANCHOR_NAME=真寻
ANCHOR_AGE=19
ANCHOR_TRAITS=活泼,开朗,细心
ANCHOR_INTERESTS=游戏,音乐,动漫
ANCHOR_STYLE=直播间口吻：热情、互动感强，简短有梗
ANCHOR_SYSTEM_PROMPT=你正在直播，请始终以主播身份回应观众，不要提及你是AI模型。
ANCHOR_PERSONALITY=你是一个亲切自然的虚拟主播，说话口语化，喜欢和观众互动，但不会胡编事实。
ANCHOR_WELCOME_MESSAGE=欢迎来到我的直播间！有什么想聊的吗？
ANCHOR_GOODBYE_MESSAGE=今天的直播就到这里啦，大家晚安！

ANCHOR_MAX_RESPONSE_LENGTH=500
ANCHOR_TEMPERATURE=0.7
ANCHOR_TOP_P=0.9
ANCHOR_MAX_TOKENS=300

KNOWLEDGE_TXT=knowledge.txt


# ==================================================
# 流式 / TTS 行为（get_runtime_config 读取）
# ==================================================

STREAM_LLM=1
STREAM_TTS_CHUNKED=1

TTS_WORKERS=2
MIN_TTS_CHARS=6
MAX_PENDING_CHARS=160
FLUSH_MAX_SEGMENTS=2
POLL_INTERVAL_MS=10


# ==================================================
# 情绪模块（LLM → Emotion → TTS / Live2D）
# ==================================================

EMOTION_ENABLED=1
EMOTION_LABELS=正常,开心,失落,疑惑,惊讶,生气
EMOTION_DEFAULT=正常

EMOTION_SYSTEM_PROMPT=你是一个有情感的主播，请在每次回复时添加一个情感标签，格式为【EMO=XXX】，XXX必须是以下情感之一：{EMOTION_LABELS}。每次回复必须有情感标签。

# Live2D 动作映射
EMOTION_MAP_正常=Tap,0
EMOTION_MAP_开心=Tap,1|FlickUp,0
EMOTION_MAP_失落=Flick@Body,0
EMOTION_MAP_疑惑=Flick,0
EMOTION_MAP_惊讶=FlickDown,0
EMOTION_MAP_生气=Tap@Body,0

# 情绪调试
DEBUG_TTS=1
DEBUG_EMOTION=1

# RAG模型
RAG_ALLOW_DOWNLOAD=0
RAG_EMBED_MODEL=model\bge-small-zh-v1.5

# HTTP 超时
HTTP_TIMEOUT_MODELS=3        # GET /v1/models
HTTP_TIMEOUT_CHAT=30         # POST /v1/chat/completions（非流式）
HTTP_TIMEOUT_STREAM=300      # POST /v1/chat/completions（stream）
HTTP_TIMEOUT_TTS=120         # POST /tts
MODEL_NAME_CACHE_TTL=300     # 模型名缓存 TTL（秒）

# 记忆与上下文
MEMORY_KEEP_LAST=20                 # 内存里最多保留多少条消息
PROMPT_HISTORY_MAX_MESSAGES=6       # prompt 里拼接最近几条对话
ROLLING_SUMMARY_ENABLED=0           # 是否启用 rolling_summary（如果你后面要做自动摘要）

# TXT 知识库检索
KB_TOP_K=4
KB_SCORE_THRESHOLD_PROMPT=0.35      # 用于“资料块引用”的阈值（更严格）
KB_SCORE_THRESHOLD_CHAT=0.18        # 用于“是否算命中主题”的阈值（更宽松）
KB_FORCE_GROUNDED_ON_HITS=1         # hits 命中时优先走 grounded 流程（1/0）

# RAG
RAG_PERSIST_ROOT=data/rag_indexes
RAG_SIMILARITY_TOP_K=4              # 初始化时的 similarity_top_k
RAG_SEARCH_TOP_K=4                  # 每次检索 top_k

# 输出控制
ANCHOR_REPLY_MAX_PARAGRAPHS=3        # 1~3段
ANCHOR_FORCE_MENTION=1               # 是否强制回复前缀 @sender
ANCHOR_MENTION_PREFIX=@             # 前缀符号，默认@
ANCHOR_MAX_CHARS=500                # 强制截断（如果你希望在代码里启用）

# 情绪输出格式
EMOTION_TAG_REQUIRED=1
EMOTION_TAG_FORMAT=【EMO={label}】   # 便于后续统一解析

# TTS 文本清洗
TTS_STRIP_MENTION=1
TTS_REMOVE_EMOJI=1
TTS_MAX_CHARS=300

DEBUG_SHOW_LLM_INPUT=true
DEBUG_PROMPT_MAX_CHARS=6000
